<h2>Permission list</h2>
<script>
    var parsedToken = isLoggedIn();
    if (parsedToken){
        //if admin role -> Request stuff from api
        if(jQuery.inArray("admin", parsedToken['roles']) !== -1) {
            sendData('user', 'listAllPermission');
        }
    }
    else {
        $("#app").html('<button type="button" onclick="var page=\'/\';getPage(page);history.pushState(page, page, page);">Error Go Home</button>');
    }

    function onResponse(data){
        if (data['payload']!='' && data['payload']!='[]' && data['payload']!=null)
        {
            var payload = data['payload'] ;
            if (data['action'] == 'listAllPermission') {
                $("#app").append("<table id ='permissionlist' style='width:100%;margin-bottom:10px;'></table>");
                 //foreach item in payload
                $("#permissionlist").append('<thead><tr><th>id</th><th>permission</th></tr></thead><tbody></tbody>');
                var thead = [];
                payload['roles'].forEach ((role, index) => {
                     thead.push(role['role_name']);
                });

                //foreach thead item -> table head append
                thead.forEach ((item, index) => {
                    $("#permissionlist > thead > tr").append('<th>' + item + '</th>');
                });
                //foreach permission -> table body append
                payload['permissions'].forEach ((permission, index) => {
                    $("#permissionlist > tbody").append("<tr id='"+ permission['permission_id'] +"'><td data-label='permission_id'>" + permission['permission_id'] + "</td><td data-label='permission_name'>" + permission['permission_name'] + "</td></tr>");
                    payload['roles'].forEach ((item, index2) => {
                        if(permission['roles'][index2] == item['role_id']) {
                            $("#permissionlist > tbody > tr").last().append('<td class="alignright" data-label="' + item['role_name'] + '"><input onclick="cbevent(' + permission['permission_id'] + ', ' + item['role_id'] + ');" id="' + item['role_id'] + '"  type="checkbox" checked></td>');
                        }
                        else{
                            $("#permissionlist > tbody > tr").last().append('<td class="alignright" data-label="' + item['role_name'] + '"><input onclick="cbevent(' + permission['permission_id'] + ', ' + item['role_id'] + ');" id="' + item['role_id'] + '"  type="checkbox"></td>');
                        }
                    });
                });
            }
            if (data['action'] == 'addPermissionToRole') {
                $("#status").html('<p>' + payload['message'] + '</p>').fadeIn(setTimeout(fade_out, 10000));
            }
            if (data['action'] == 'removePermissionFromRole') {
                $("#status").html('<p>' + payload['message'] + '</p>').fadeIn(setTimeout(fade_out, 10000));
            }
        }
    }

function cbevent(perm_id, role_id) {
    //$("#status").html('<p>permission_id: ' + perm_id + '\nrole_id: ' + role_id + '</p>').fadeIn(setTimeout(fade_out, 10000));
    var payload = {};
    payload['permission_id'] = perm_id;
    payload['role_id'] = role_id;
    //get element by perm_id > role_id.. if checked...
    if($('#' + perm_id + ' #' + role_id).is(':checked')) {
        sendData('user', 'addPermissionToRole', payload);
    } else {
        sendData('user', 'removePermissionFromRole', payload);
    }
}
    </script>
